<script>
var options = {
	template: '../lib/pair/program.html',
	id: 'generic_program',
	previous: 'generic_choice',
	title: 'deviceClasses.generic_socket.views.generic_program.title',
	body: 'deviceClasses.generic_socket.views.generic_program.body',
	svg: '<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="389.000000pt" height="803.000000pt" viewBox="0 0 389.000000 803.000000"\n preserveAspectRatio="xMidYMid meet">\n<metadata>\nCreated by potrace 1.13, written by Peter Selinger 2001-2015\n</metadata>\n<g transform="translate(0.000000,803.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M163 8011 c-59 -27 -119 -93 -143 -157 l-20 -55 0 -3774 0 -3774 21\n-56 c27 -72 92 -137 164 -164 56 -21 62 -21 1745 -21 1683 0 1689 0 1745 21\n72 27 137 92 164 164 l21 56 0 3774 0 3774 -20 55 c-24 64 -84 130 -143 157\n-41 18 -96 19 -1767 19 -1671 0 -1726 -1 -1767 -19z m3512 -48 c47 -25 85 -64\n111 -113 18 -34 19 -146 19 -3825 0 -3679 -1 -3791 -19 -3825 -26 -49 -64 -88\n-111 -113 l-40 -22 -1705 0 -1705 0 -40 22 c-47 25 -85 64 -111 113 -18 34\n-19 146 -19 3825 0 3679 1 3791 19 3825 36 69 92 114 161 131 17 4 788 6 1715\n5 l1685 -1 40 -22z"/>\n<path d="M1045 6676 c-126 -55 -180 -204 -117 -327 77 -152 266 -181 384 -59\n65 67 84 149 56 241 -15 52 -73 117 -122 140 -49 22 -156 25 -201 5z"/>\n<path d="M1770 3939 c-433 -36 -850 -239 -1157 -563 -508 -537 -635 -1326\n-322 -2004 140 -303 395 -590 685 -770 646 -401 1472 -356 2069 113 608 478\n846 1282 594 2013 -235 680 -844 1152 -1566 1212 -131 11 -166 11 -303 -1z\nm418 -64 c729 -109 1316 -665 1461 -1382 201 -990 -459 -1934 -1464 -2094\n-103 -17 -407 -17 -510 -1 -822 131 -1432 789 -1494 1610 -71 932 602 1754\n1534 1875 82 11 383 6 473 -8z"/>\n<path d="M1756 3739 c-621 -65 -1157 -498 -1355 -1094 -59 -177 -74 -280 -75\n-495 -1 -226 13 -325 75 -512 82 -253 196 -437 393 -634 199 -199 388 -315\n644 -398 322 -104 675 -103 993 4 261 87 437 196 634 394 196 196 313 385 395\n634 61 187 75 286 74 512 0 161 -4 213 -22 297 -68 316 -203 577 -415 800\n-345 364 -839 545 -1341 492z m302 -49 c451 -40 847 -258 1116 -613 l36 -49 0\n-384 0 -384 134 0 c155 0 146 8 146 -120 0 -128 9 -120 -146 -120 l-134 0 0\n-388 0 -387 -68 -85 c-233 -288 -532 -469 -914 -552 -147 -32 -456 -32 -601 0\n-372 82 -684 271 -908 550 l-59 73 0 395 0 394 -139 0 c-117 0 -140 2 -145 16\n-8 20 -8 172 0 202 6 21 10 22 145 22 l139 0 0 393 0 394 80 96 c254 307 645\n511 1047 546 128 12 147 12 271 1z m-1428 -1055 l0 -355 -126 0 -126 0 7 58\nc18 155 76 344 147 487 46 91 88 165 94 165 2 0 4 -160 4 -355z m2694 197 c74\n-147 133 -342 151 -494 l7 -58 -121 0 -121 0 0 353 0 352 20 -33 c11 -18 40\n-72 64 -120z m-2694 -1194 c0 -407 6 -394 -94 -193 -80 162 -126 314 -152 498\nl-6 47 126 0 126 0 0 -352z m2845 300 c-26 -201 -96 -406 -194 -573 l-41 -70\n0 348 0 347 121 0 121 0 -7 -52z"/>\n<path d="M1145 2368 c-103 -39 -165 -125 -165 -228 0 -142 112 -247 255 -238\n247 16 308 341 86 453 -42 21 -136 28 -176 13z"/>\n<path d="M2526 2366 c-171 -64 -215 -286 -80 -404 158 -140 398 -32 398 178 0\n70 -16 113 -63 163 -59 64 -175 93 -255 63z"/>\n</g>\n</svg>\n',
	svgWidth: '80vw',
	svgHeight: '70vh',
	initWithDeviceData: false,
	next: true
};
Homey.setTitle(__(options.title || ''));
Homey.emit('init', options.id);
Homey.on('show_view', function(viewId){
	Homey.showView(viewId);
});
Homey.on('close', function(){
	Homey.close();
});
Homey.on('nextView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) + 1;
	if(viewIndex > 0 && viewIndex < viewsIds.length){
		Homey.showView(viewsIds[viewIndex]);
	}
});
Homey.on('previousView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) - 1;
	if(viewIndex >= 0){
		Homey.showView(viewsIds[viewIndex]);
	}
});
function nextView(){
	if(options.next){
		Homey.nextView();
	}else{
		Homey.emit('next');
	}
}
</script>

<link href="../../../assets/433_generator/css/styles.css" rel="stylesheet" type="text/css"/>

<link href="../../../assets/433_generator/css/svg.css" rel="stylesheet" type="text/css"/>

<script src="../../../assets/433_generator/js/svghighlighter.js" type="text/javascript"></script>

<link href="../../../assets/433_generator/css/styles.css" rel="stylesheet" type="text/css"/>

<link href="../../../assets/433_generator/css/svg.css" rel="stylesheet" type="text/css"/>

<script src="../../../assets/433_generator/js/svghighlighter.js" type="text/javascript"></script>

<div class="centered-container">
	<div id="image-container"></div>
	<div id="body"><span class="content"></span></div>
	<div class="programAnimation" id="sendProgramSignalBackground" style="display:none;"></div>
	<i class="loading fa fa-cog fa-spin programAnimation" id="sendProgramSignalSpinner" style="display:none;"></i>
</div>

<script>
	var $container = $('[data-id="' + options.id + '"] ');
	$container.find('#body > span').html(__(options.body));
	var $imageContainer = $container.find('#image-container');
	$imageContainer.css('width', options.svgWidth).css('height', options.svgHeight);
	var $programElems = $container.find('.programAnimation');

	$imageContainer.html(options.svg);
	$imageContainer.highlight();

	if (!$container.find('.view-navigation-next.dummy').length) {
		var $nextButton = $container.find('.view-navigation-next');
		var $nextButtonDummy = $nextButton.clone().addClass('dummy');
		$nextButton.hide();
		$nextButton.parent().append($nextButtonDummy);

		$nextButtonDummy.on('click', function (e) {
			$programElems.show();
			Homey.emit('program_send', function (err) {
				if (err){
					Homey.alert(err.message && err.message.indexOf(' ') === -1 && __(err.message) !== err.message ? __(err.message) : JSON.stringify(err));
					return;
				}
				$nextButtonDummy.siblings('.view-navigation-next').click();
				$programElems.hide();
			});
			e.stopPropagation();
			return false;
		});
	}

	Homey.emit('program', function(err, device){
		const dataKey = JSON.stringify(device.data);
		window.selected_devices = [ dataKey ];
		window.found_devices = {};
		window.found_devices[dataKey] = device;
	});
</script>

<style>
	#sendProgramSignalSpinner {
		z-index: 2;
		position: absolute;
		top: 25vh;
		left: 38vw;
		font-size: 9vh;
		opacity: 1;
	}

	#sendProgramSignalBackground {
		z-index: 1;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		position: absolute;
		background-color: #FFF;
		opacity: 0.8;
	}
</style>